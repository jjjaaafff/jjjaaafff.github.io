<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Estimation | Aofan Jiang</title> <meta name="author" content="Aofan Jiang"> <meta name="description" content="Lecture Notes on Causal Inference"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jjjaaafff.github.io/blog/2021/causal6/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Estimation",
      "description": "Lecture Notes on Causal Inference",
      "published": "July 15, 2021",
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span>Aofan Jiang (蒋傲凡)</span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Estimation</h1> <p>Lecture Notes on Causal Inference</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#preliminaries">Preliminaries</a></div> <div><a href="#conditional-outcome-modeling-com">Conditional outcome modeling (COM)</a></div> <div><a href="#increasing-data-efficiency">Increasing Data Efficiency</a></div> <div><a href="#propensity-scores">Propensity scores</a></div> <div><a href="#inverse-probability-weighting-ipw">Inverse probability weighting (IPW)</a></div> <div><a href="#other-methods">Other Methods</a></div> </nav> </d-contents> <h2 id="preliminaries">Preliminaries</h2> <p>在之前的内容中，我们通过indentification，将Causal Estimand转换为Statistical Estimand，即 $P(Y\vert do(t)) \rightarrow P(Y\vert t)$ 。接下来在本章的部分，我们进行的是下一阶段，对Statistical Estimand $P(Y\vert t)$ 进行估计。在Estimation中，我们输入数据，得到预测结果</p> <p>此外，我们还需要引入一个新的概念Conditional average treatment effects (CATEs)，和之前讲过的ATE相比，多了一个条件，记为</p> \[\tau(x) \triangleq E[Y(1)-Y(0)\vert X=x]\] <p>按与之类似的写法，之前的ATE可以表示为</p> \[\tau \triangleq E[Y(1)-Y(0)]\] <p>在该公式中，X不一定必须是观测变量，尽管通常都是。</p> <h2 id="conditional-outcome-modeling-com">Conditional outcome modeling (COM)</h2> <p>展开我们之前写出的ATE的公式，我们可以得到熟悉的<br> \(\tau = E_W [E[Y \vert T = 1, W] - E[Y \vert T = 0, W]]\)<br> 在estimation阶段，我们需要对$E[Y \vert T = 1, W]$进行建模，为了方便，我们重写ATE的公式</p> \[\tau = E_W [\mu(1,W) - \mu(0,W)]\] <p>这里的 $\mu(1,W)$ 和 $\mu(0,W)$ 即为我们的建模(比如利用DNN，则这里表示两个网络模型)。接下来我们需要对W近似，因为可能其维度太高，数据太多，无法得到准确的期望值，此时近似后的ATE我们称为ATE COM Estimator，即</p> \[\hat{\tau} = \frac{1}{n} \sum_i(\hat{\mu}(1,w_i) - \hat{\mu}(0,w_i))\] <p>同理，对于CATE，我们也是首先定义$\mu$来方便表示我们建立的模型，因为包含条件概率，我们记作</p> \[\mu(t,w,x)\triangleq E[Y\vert T=t,W=w,X=x]\] <p>再对W进行近似，得到近似后的 $\hat{\tau(x)}$，我们称为CATE COM Estimator，即</p> \[\hat{\tau}(x) = \frac{1}{n_x} \sum_{i:x_i=x}(\hat{\mu}(1,w_i,x) - \hat{\mu}(0,w_i,x))\] <p>COM还有一些其它的称呼，比如G-computation estimators、Parametric G-formula、Standardization and S-learner where “S” is for “Single”</p> <p>但现在存在一个问题，此时模型的输入为 W 和 T，W 为高维数据，T为一维数据。大量从 T 出来的权值都为0或极小值，对结果的影响几乎为零。该问题称为 estimate can be biased toward zero，那么我们应该怎么做来让模型不再忽略 T 的作用呢，由此我们引出Grouped COM (GCOM)</p> <p>在 GCOM 下，我们用两个网络(模型)分别去模拟T=0和T=1的情况，此时T信息就被隐含地编码的不同网络中了，此时可以写出对应的GCOM Estimator，即</p> \[\hat{\tau} = \frac{1}{n} \sum_i(\hat{\mu}_1(w_i) - \hat{\mu}_0(w_i))\] <p>对于T=1的网络，我们称为treatment group，就只用包含T=1的数据训练；同样，对于T=0的网络，我们称为control group，只用包含T=0的数据训练。这又引出了新的问题，这样数据的利用效率是很低的，我们应该如何提升利用效率呢？</p> <h2 id="increasing-data-efficiency">Increasing Data Efficiency</h2> <ul> <li> <p>TARNet<br> <img src="/assets/img/ICI_lec6_1.JPG" alt="TARNet结构" title="TARNet结构"> <br> 相比与GCOM，TARNet的第一步利用的是全部数据，因此数据利用效率更高。但此方式仍然有局限性，那就是在第二步，指向 $T=0$ 和 $T=1$ 时，这里还是分别用treatment 和 control group的数据</p> </li> <li> <p>X-Learner<br> 该方法流程如下</p> <ol> <li>估计 $\hat{\mu}_1(x)$ 和 $\hat{\mu}_0(x)$</li> <li>提前计算ITE，对于treatment group, \(\hat{\tau}_{1,i} = Y_i(1) - \hat{\mu}_0(x_i)\)<br> 对于control group, \(\hat{\tau}_{0,i} = \hat{\mu}_1(x_i) - Y_i(0)\)</li> <li>用 treatment group 中的 $x_i$ 拟合模型 \(\hat{\tau}_{1}(x)\) 来预测 \(\hat{\tau}_{1,i}\)<br> 用 control group 中的 $x_i$ 拟合模型 \(\hat{\tau}_{0}(x)\) 来预测 \(\hat{\tau}_{0,i}\)</li> <li>最终的估计, \(\hat{\tau}(x) = g(x)\hat{\tau}_{0}(x) + (1-g(x))\hat{\tau}_{1}(x)\) ,这里的g(x)是权重方程，比如可以是propensity score</li> </ol> </li> </ul> <h2 id="propensity-scores">Propensity scores</h2> <p>我们定义Propensity scores e(w)为 $e(w)\triangleq P(T=1 \vert W)$<br> 我们可以发现，无论 W 是多少维的数据，其Propensity scores e(w)永远是一维数据。基于Propensity scores，我们有一个定理</p> \[(Y(1),Y(0)) \perp \!\!\! \perp T\vert W \Rightarrow (Y(1),Y(0)) \perp \!\!\! \perp T\vert e(W)\] <p>这个定理成立是因为condition on W 时，我们相当于移除因果图中 W 这个节点，使Y与T独立。而condition on e(W)时，我们相当于移除因果图中 W 到 T 的所有边，这样block掉了所有的backdoor path，同样得到独立</p> <p>为此我们想到了Positivity-Unconfoundedness Tradeoff，我们能不能用e(W)去代替W实现降维呢？这样的话overlap的程度就会更高。</p> <p>但这样是不行的，因为我们无法得到 $P(T=1 \vert W)$，在实际中，最好的方式是对其建模，把降维问题转化为对e(W)的建模问题</p> <h2 id="inverse-probability-weighting-ipw">Inverse probability weighting (IPW)</h2> <p>在介绍IPW之前，我们首先说明一下应用背景。在经典的(T,W,Y)三元例子中，correlation并不等于causality，即 $P(T\vert W)\neq P(T)$ ，这也导致我们无法分析T与Y的causal effect。但是如果 $P(T\vert W)= P(T)$ 或者是 $P(T\vert W)=1$ ，则此时 T 与 Y 之间就只存在因果关系，没有其他关系了。为了实现这种情况，我们可以对 $P(T\vert W)$ 这一项除以相同大小的值，即可将其变为1。由此引出 IPW</p> <p>在IPW中，我们对 Y 这一变量进行处理，此时 $E[Y(t)]=E[\frac{1(T=t)Y}{p(t\vert W)}]$ ，ATE的公式也随之发生改变，即</p> \[\tau \triangleq E[Y(1)-Y(0)] = E[\frac{1(T=1)Y}{e(W)}] - E[\frac{1(T=0)Y}{1-e(W)}]\] <p>对 W 近似后的公式为</p> \[\hat{\tau} = \frac{1}{n_1} \sum_{i:t_i=1}\frac{y_i}{\hat{e}(w_i)} - \frac{1}{n_0} \sum_{i:t_i=0}\frac{y_i}{1-\hat{e}(w_i)}\] <p>在CATE estimation下应该如何应用呢？这超出了课程范围，可以阅读参考文献<br> <a href="https://www.tandfonline.com/doi/full/10.1080/07350015.2014.975555" rel="external nofollow noopener" target="_blank">https://www.tandfonline.com/doi/full/10.1080/07350015.2014.975555</a></p> <h2 id="other-methods">Other Methods</h2> <p>这里简要介绍一些其他的建模估计方法</p> <ul> <li>同时利用COM和propensity score models，分别对 $\mu(t,w)$ 和e(w)进行建模<br> Consistent if either or is consistent<br> 理论上比 COM/IPW 更快地收敛到estimand</li> <li>Matching，将treatment group中的点对应到control group，使其对应两点间距离最小，有各种不同的criteria</li> <li>Double machine learning<br> 该方法分为两步，首先训练一个模型从W预测Y，得到预测值$\hat{Y}$，再训练一个模型从W预测T，得到预测值$\hat{T}$。第二步训练模型从$T-\hat{T}$中预测$Y-\hat{Y}$，以此来消除W的影响</li> <li>Causal trees and forests<br> Flexible and yield valid confidence intervals (for sampling variability)</li> </ul> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2024 Aofan Jiang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: March 20, 2024. </div> <div id="map-container" style="display: none;"> <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?cl=ffffff&amp;w=300&amp;t=n&amp;d=vcetvMKxQeU0A74GGVddvtKdDYpzY562Hjs3OBdOjBw"></script> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>