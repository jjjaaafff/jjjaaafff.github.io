<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Counterfactuals and Mediation | Aofan Jiang</title> <meta name="author" content="Aofan Jiang"> <meta name="description" content="Lecture Notes on Causal Inference"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jjjaaafff.github.io/blog/2021/causal13/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Counterfactuals and Mediation",
      "description": "Lecture Notes on Causal Inference",
      "published": "July 22, 2021",
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span>Aofan Jiang (蒋傲凡)</span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Counterfactuals and Mediation</h1> <p>Lecture Notes on Causal Inference</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#counterfactuals-basics">Counterfactuals Basics</a></div> <div><a href="#mediation">Mediation</a></div> </nav> </d-contents> <h2 id="counterfactuals-basics">Counterfactuals Basics</h2> <p>正如我们在之前提到的，因果推理中的根本问题，对于一个个体而言，我们只能观察到causal effect 中的一项，此时另外一项即称为 Counterfactuals 。其数学形式如下</p> \[P(Y(t)\vert T=t',Y=y')\] <p>可以看到，观察到的数据与假定的条件是不一致的。这与CATE不同，在CATE中，$E[Y (t) \vert X = x] = E[Y \vert do(t), X = x]$ ，这两者是一致的。由此也表明，我们无法用 do-notation 来表示 counterfactuals</p> <p>那么，从个体的角度来看，应该如何计算 counterfactuals 呢？<br> 在该问题下，我们已知的是观测数据 (T,Y)，我们假设知道 Y 的正确的structural equation，此时我们需要计算出个体层次的 Y(t’)，计算流程如下</p> <ol> <li>Abduction：我们首先利用观测数据来确定 Y 的结构方程中的隐藏变量 U 的值</li> <li>Action：我们修改 T 对应的结构方程，将其替换为不同的treatment，即 T:=t’。同时将 U 的值代入 Y 的结构方程，得到针对该个体的 SCM</li> <li>我们结合步骤一和步骤二，计算出 T=t’ 下该个体对应的 Y 值，即为 counterfactuals 值</li> </ol> <p>这时存在一个问题，即使我们有 Y 的结构方程，我们也不能百分百地确定counterfactuals的值。比如当我们无法计算U的值时（U和Y不是一一对应时），那么当我们观测到一个 Y 值时，我们无法确定具体哪个 U 值可以对应到 Y（有若干个不同的选项）。在这种情况下，我们需要结合 U 的个体分布先验概率，计算流程如下</p> <ol> <li>Abduction：我们首先利用观测数据 Z 来更新 U 的分布，$P(U\vert Z)$</li> <li>Action：我们修改 T 对应的结构方程，将其替换为不同的treatment，即 T:=t’</li> <li>我们结合步骤一和步骤二，计算出 T=t’ 下该个体对应的 Y(t’) 分布，即为 counterfactuals 分布。（对于个体而言，此时我们只能得到一个分布，无法得到具体的counterfactuals值）</li> </ol> <p>以上这些方法都是基于一个假设，我们知道 Y 的parametric model。但这个假设是很强的，如果没有这个假设，我们就无法计算个体层面的 counterfactuals。而如果我们想计算整个人群的 counterfactuals，那么我们就不需要知道 Parametric model</p> <p>Population-level counterfactual：$E[Y(t)\vert T=t’]$ 。此时的计算方式就像我们之前的ATE一样，如果它们是 identifiable ，我们就可以完全按照 ATE 的处理方式来计算 Population-level counterfactual</p> <h2 id="mediation">Mediation</h2> <p>举个例子，如果我养了一只狗，那么我会很高兴。但应该如何衡量养狗对我心情的直接影响呢？可能养狗会让我交到更多的朋友，而交朋友对我的心情有重大影响。那么此时养狗对我心情的直接影响就没有那么大了，我应该考虑多交朋友而不是多养狗。由此，我们需要衡量 treatment 对结果的直接影响。</p> <p>第一种衡量方式称为 Controlled Direct Effect (CDE)，我们直接对中间原因干预，计算干预下的causal effect，即 $E[Y \vert do(T = 1, M = m)] - E[Y \vert do(T = 0, M = m)]$ 。注意，这里我们采用 do 而不是观测数据，这是因为观测数据可能会引入新的联系，对结果产生干扰</p> <p>这种衡量方式存在两个问题</p> <ol> <li>CDE 很大程度上受中间变量的影响，当 M 的值不同时，对应的causal effect可能相差会很大</li> <li>我们没办法计算 indirect effect，我们不能直接用总的causal effect减去CDE作为 indirect effect</li> </ol> <p>第二种方式称为 Natural Direct and Indirect Effects (NDE,NIE)，在介绍这种方式之前，首先引入一些记号</p> \[E[Y_{t,m}] \triangleq E[Y \vert do(T = t, M = m)] \quad E[M_t] \triangleq E[M\vert do(T=t)]\] <p>基于这些记号，我们可以定义衡量方式</p> \[CDE \triangleq E[Y_{1,m}-Y_{0,m}]\] \[NDE \triangleq E[Y_{1,M_0}-Y_{0,M_0}]\] \[NIE \triangleq E[Y_{0,M_1}-Y_{0,M_0}]\] <p>之所以称为 natural，是因为在计算 direct effect时，treatment 分别采取 0 和 1，而中间变量保持一致，保持为无treatment下的期望。同样，在计算 indirect effect时，treatment保持一致，保持为无treatment。此时的total effect也可以表示出来，即</p> \[TE = NDE-NIE_r\] <p>$NIE_r$ 表示将NIE表达式中所有的 0 和 1 对应替换</p> <p>接下来的一个问题是，给出这样一种衡量方式后，我们在什么情况下可以用这种方式呢？这需要一些前提条件，假设 adjustment set 记为 W</p> <ol> <li>W中不包含 T 的子节点</li> <li>W blocks all backdoor paths from M to Y</li> </ol> <p>在这两个条件下，我们已经可以通过实验(do operation)来计算 NDE 的值，计算式如下</p> \[NDE = \sum_m\sum_w(E[Y_{1,m}\vert W=w] - E[Y_{0,m}\vert W=w])\times P(M = m \vert do(T = 0), W = w)P(W = w)\] <p>如果我们想更进一步，利用观测数据而不是 do operation 来计算 NDE，则需要在上述两个假设的基础上，进一步进行假设</p> <ol> <li>$P(M=m\vert do(T=0),W=w)$ is identifiable，即从 T 到 M 没有不可阻断的 backdoor path</li> <li>$E[Y\vert do(T=t,M=m),W=w]$ is identifiable，即从 T 到 Y 没有不可阻断的 backdoor path</li> </ol> <p>在补充的两个假设下，我们可以去掉上述 NDE 计算式中的 do-operation，并将其替换为观测结果</p> <p>最后我们比较一下 controlled mediation 和 natural mediation</p> <ul> <li>CDE 永远都可以利用实验（do-operator）来测量，但我们无法得到明确的 undirect effect</li> <li>NDE 不能保证始终可以用实验测量，但它允许我们分别计算得到 direct effect 和 undirect effect，并可以组合得到 total effect</li> </ul> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2023 Aofan Jiang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: November 29, 2023. </div> <div id="map-container" style="display: none;"> <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?cl=ffffff&amp;w=300&amp;t=n&amp;d=vcetvMKxQeU0A74GGVddvtKdDYpzY562Hjs3OBdOjBw"></script> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>